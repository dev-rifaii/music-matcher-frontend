(function(){"use strict";var e={6125:function(e,t,r){var s=r(9963),n=r(6252);const o={class:"container"},a=(0,n._)("body",null,null,-1);function c(e,t,r,s,c,i){const u=(0,n.up)("Header"),h=(0,n.up)("router-view"),l=(0,n.up)("Footer");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n._)("div",o,[(0,n.Wm)(u),(0,n.Wm)(h),a]),(0,n.Wm)(l)],64)}const i=e=>((0,n.dD)("data-v-63bf37e4"),e=e(),(0,n.Cn)(),e),u=i((()=>(0,n._)("h1",null,"Music Matcher",-1)));function h(e,t,r,s,o,a){const c=(0,n.up)("AuthenticatedPrev"),i=(0,n.up)("Button");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n._)("header",null,[u,1==a.tokenIsValid()?((0,n.wg)(),(0,n.j4)(c,{key:0})):(0,n.kq)("",!0)]),(0,n._)("body",null,[(0,n._)("div",null,["/"==this.$route.path?((0,n.wg)(),(0,n.j4)(i,{key:0,text:"Login",color:"green",size:"20px 100px",route:"login"})):(0,n.kq)("",!0)])])],64)}var l=r(3577);function p(e,t,r,s,o,a){return(0,n.wg)(),(0,n.iD)("button",{onClick:t[0]||(t[0]=t=>e.$router.push(r.route)),style:(0,l.j5)({background:r.color,padding:r.size,width:r.width,height:r.height}),class:"btn customButton"},(0,l.zw)(r.text),5)}var m={name:"Button",props:{text:String,color:String,route:String,size:String,width:String,height:String},methods:{onClick(){}}},d=r(3744);const g=(0,d.Z)(m,[["render",p]]);var f=g;function w(e,t,r,s,o,a){const c=(0,n.up)("Button");return(0,n.wg)(),(0,n.j4)(c,{color:"green",route:"home",text:"🏠"})}var v={name:"AuthenticatedPrev",components:{Button:f}};const k=(0,d.Z)(v,[["render",w]]);var y=k,b={name:"Header",components:{Button:f,AuthenticatedPrev:y},methods:{tokenIsValid(){Date.now();return null!=localStorage.getItem("jwt")}}};const _=(0,d.Z)(b,[["render",h],["__scopeId","data-v-63bf37e4"]]);var S=_;const I=(0,n.Uk)("About"),C=(0,n.Uk)(" | Login Page");function D(e,t,r,s,o,a){const c=(0,n.up)("router-link");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(c,{class:"about",to:"/about"},{default:(0,n.w5)((()=>[I])),_:1}),"/"!=this.$route.path?((0,n.wg)(),(0,n.j4)(c,{key:0,class:"about",to:"/"},{default:(0,n.w5)((()=>[C])),_:1})):(0,n.kq)("",!0)],64)}var j={name:"Footer"};const O=(0,d.Z)(j,[["render",D],["__scopeId","data-v-9d78b4d8"]]);var x=O,H={name:"App",components:{Header:S,Footer:x}};const T=(0,d.Z)(H,[["render",c]]);var U=T,E=(r(6699),r(2119));function Z(e,t,r,s,o,a){const c=(0,n.up)("User");return(0,n.wg)(),(0,n.j4)(c,{user:o.profile},null,8,["user"])}var $=r(9669),q=r.n($);const B={class:"card",style:{width:"18rem"}},W=["src"],Y={class:"card-body"},M={class:"card-text"},N={class:"card-text"},P={class:"card-text"},z=(0,n._)("br",null,null,-1),J={key:2};function A(e,t,r,o,a,c){return(0,n.wg)(),(0,n.iD)("div",B,[(0,n._)("img",{src:r.user.image,class:"card-img-top",onError:t[0]||(t[0]=e=>e.target.src="https://static.thenounproject.com/png/82455-200.png")},null,40,W),(0,n._)("div",Y,[(0,n._)("p",M,"Country: "+(0,l.zw)(r.user.country),1),(0,n._)("p",N,"Email: "+(0,l.zw)(r.user.email),1),(0,n._)("p",P,"Biography: "+(0,l.zw)(r.user.biography),1),"/profile"==this.$route.path?(0,n.wy)(((0,n.wg)(),(0,n.iD)("input",{key:0,id:"bioinput",type:"text",class:"form-control",ref:"inp","aria-describedby":"emailHelp",placeholder:"change biography","onUpdate:modelValue":t[1]||(t[1]=t=>e.bid=t)},null,512)),[[s.nr,e.bid]]):(0,n.kq)("",!0),z,"/profile"==this.$route.path?((0,n.wg)(),(0,n.iD)("button",{key:1,type:"button",onClick:t[2]||(t[2]=e=>c.setBio()),class:"btn setBio"}," Set Bio ")):(0,n.kq)("",!0),1==a.enough?((0,n.wg)(),(0,n.iD)("label",J,"Minimum 20 characters")):(0,n.kq)("",!0)])])}var V={name:"User",props:{user:Object},data(){return{id:String,enough:Boolean}},methods:{setBio(){if(!this.checkInput())return void(this.enough=!0);let e=localStorage.getItem("jwt");e=e.substring(1,e.length),q().post("https://musicmatcher-api.herokuapp.com/spotifymatcher/users/bio",this.bid,{headers:{"Content-Type":"text/plain",jwt:e}}).then((()=>location.reload())).catch((e=>{200!==e.response.status&&this.$router.push("error")}))},checkInput(){return this.bid.length>=20}}};const K=(0,d.Z)(V,[["render",A]]);var R=K,F={name:"ProfileView",components:{User:R},data(){return{profile:Object,token:String}},async created(){let e=localStorage.getItem("jwt");e=e.substring(1,e.length);try{const t=await q().get("https://musicmatcher-api.herokuapp.com/spotifymatcher/users/profile",{headers:{jwt:e}});this.profile=t.data}catch(t){this.$router.push("error"),console.error(t)}}};const L=(0,d.Z)(F,[["render",Z]]);var G=L;const Q={class:"buttonsContainer"},X={key:0};function ee(e,t,r,s,o,a){const c=(0,n.up)("Button"),i=(0,n.up)("profile-view");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n._)("div",Q,[(0,n.Wm)(c,{text:"profile",color:"green",route:"profile"}),(0,n.Wm)(c,{text:"tracks",color:"green",route:"tracks"}),(0,n.Wm)(c,{text:"matches",color:"green",route:"matches"}),(0,n.Wm)(c,{width:"28.6%",text:"chat",color:"green",route:"chat"}),(0,n.Wm)(c,{width:"100%",height:"100%",text:"match",route:"matcher"})]),"profile"==o.currentPage?((0,n.wg)(),(0,n.iD)("div",X,[(0,n.Wm)(i)])):(0,n.kq)("",!0)],64)}var te={name:"Home",data(){return{currentPage:"home"}},components:{Button:f}};const re=(0,d.Z)(te,[["render",ee],["__scopeId","data-v-b5d3053c"]]);var se=re;function ne(e,t,r,s,o,a){const c=(0,n.up)("Tracks");return(0,n.wg)(),(0,n.j4)(c,{tracks:o.tracks},null,8,["tracks"])}const oe={class:"row row-cols-1 row-cols-md-5"},ae={class:"col mb-4"};function ce(e,t,r,s,o,a){const c=(0,n.up)("Track");return(0,n.wg)(),(0,n.iD)("div",oe,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(r.tracks,(e=>((0,n.wg)(),(0,n.iD)("div",{key:e.id},[(0,n._)("div",ae,[(0,n.Wm)(c,{track:e},null,8,["track"])])])))),128))])}const ie={class:"card",style:{width:"10rem"}},ue=["src"],he={class:"card-body"},le=["href"];function pe(e,t,r,s,o,a){return(0,n.wg)(),(0,n.iD)("div",ie,[(0,n._)("img",{src:r.track.imageUrl,onError:t[0]||(t[0]=e=>e.target.src="https://static.thenounproject.com/png/82455-200.png"),width:"100",height:"100"},null,40,ue),(0,n._)("div",he,[(0,n._)("a",{href:r.track.href,style:{"text-decoration":"none"}},(0,l.zw)(r.track.name),9,le)])])}var me={name:"Track",props:{track:Object}};const de=(0,d.Z)(me,[["render",pe]]);var ge=de,fe={name:"Tracks",components:{Track:ge},props:{tracks:Array}};const we=(0,d.Z)(fe,[["render",ce]]);var ve=we,ke={name:"TracksView",components:{Tracks:ve},data(){return{tracks:[]}},async created(){let e=localStorage.getItem("jwt");e=e.substring(1,e.length);try{const t=await q().get("https://musicmatcher-api.herokuapp.com/spotifymatcher/users/tracks",{headers:{jwt:e}});this.tracks=t.data}catch(t){this.$router.push("error"),console.error(t)}}};const ye=(0,d.Z)(ke,[["render",ne]]);var be=ye;const _e={key:0};function Se(e,t,r,s,o,a){const c=(0,n.up)("Users");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(c,{users:o.users},null,8,["users"]),o.users.length?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("h4",_e,"No matches found"))],64)}const Ie={class:"row row-cols-1 row-cols-md-3"},Ce={class:"col mb-4"};function De(e,t,r,s,o,a){const c=(0,n.up)("User");return(0,n.wg)(),(0,n.iD)("div",Ie,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(r.users,(e=>((0,n.wg)(),(0,n.iD)("div",{key:e.id},[(0,n._)("div",Ce,[(0,n.Wm)(c,{user:e},null,8,["user"])])])))),128))])}var je={name:"Users",components:{User:R},props:{users:Array}};const Oe=(0,d.Z)(je,[["render",De]]);var xe=Oe,He={name:"Matches",components:{Users:xe},data(){return{users:[]}},async created(){let e=localStorage.getItem("jwt");e=e.substring(1,e.length);try{const t=await q().get("https://musicmatcher-api.herokuapp.com/spotifymatcher/users/matches",{headers:{jwt:e}});this.users=t.data}catch(t){this.$router.push("error"),console.error(t)}}};const Te=(0,d.Z)(He,[["render",Se]]);var Ue=Te;const Ee={key:0};function Ze(e,t,r,s,o,a){const c=(0,n.up)("Users");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(c,{users:o.users},null,8,["users"]),o.users.length?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("h4",Ee,"No matches found"))],64)}var $e={name:"Matcher",components:{Users:xe},data(){return{users:[]}},async created(){let e=localStorage.getItem("jwt");e=e.substring(1,e.length);try{const t=await q().get("https://musicmatcher-api.herokuapp.com/spotifymatcher/users/match",{headers:{jwt:e}});this.users=t.data}catch(t){401==t.response.status?this.$router.push({name:"Error",params:{message:"You need to link your socials in biography before trying to match."}}):this.$router.push("error")}}};const qe=(0,d.Z)($e,[["render",Ze]]);var Be=qe;const We=(0,n._)("p",null," The main functionality of this app is to match users depending on their most listend to songs on Spotify. ",-1),Ye=(0,n._)("p",null,[(0,n.Uk)(" Website was developed for learning purposes and is still under developement by "),(0,n._)("a",{href:"https://github.com/dev-rifaii/"},"dev-rifaii")],-1);function Me(e,t,r,s,o,a){return(0,n.wg)(),(0,n.iD)(n.HY,null,[We,Ye],64)}var Ne={name:"About"};const Pe=(0,d.Z)(Ne,[["render",Me]]);var ze=Pe;const Je=(0,n._)("h1",null,"Error",-1),Ae={key:0};function Ve(e,t,r,s,o,a){return(0,n.wg)(),(0,n.iD)(n.HY,null,[Je,null!=r.message?((0,n.wg)(),(0,n.iD)("p",Ae,"💥"+(0,l.zw)(r.message),1)):(0,n.kq)("",!0)],64)}var Ke={name:"Error",props:{message:String}};const Re=(0,d.Z)(Ke,[["render",Ve]]);var Fe=Re;const Le={key:0},Ge={class:"wrapper"},Qe={class:"content"},Xe=["onClick"],et=["src"],tt={class:"chatbox"},rt={id:"messages",class:"convo-container"},st={key:0,class:"message sender"},nt=["src"],ot={class:"sender-message-content"},at={key:1,class:"message recipient"},ct=["src"],it={class:"recipient-message-content"},ut={class:"chatboxfooter"},ht={key:1};function lt(e,t,r,o,a,c){return(0,n.wg)(),(0,n.iD)(n.HY,null,[this.matches.length>0?((0,n.wg)(),(0,n.iD)("div",Le,[(0,n._)("div",Ge,[(0,n._)("div",Qe,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(a.matches,(e=>((0,n.wg)(),(0,n.iD)("div",{key:e.id},[(0,n._)("div",{onClick:t=>c.setCurrentRecipient(e)},[(0,n._)("img",{class:"img",src:e.image},null,8,et)],8,Xe)])))),128))]),(0,n._)("div",tt,[(0,n._)("div",rt,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(a.received_messages,((e,t)=>((0,n.wg)(),(0,n.iD)("div",{key:t},[e.senderId==a.user.id?((0,n.wg)(),(0,n.iD)("div",st,[(0,n._)("img",{class:"avatar",src:a.user.image},null,8,nt),(0,n._)("p",ot,(0,l.zw)(e.content),1)])):(0,n.kq)("",!0),e.senderId==a.current_recipient.id?((0,n.wg)(),(0,n.iD)("div",at,[(0,n._)("img",{class:"avatar",src:a.current_recipient.image},null,8,ct),(0,n._)("p",it,(0,l.zw)(e.content),1)])):(0,n.kq)("",!0)])))),128))]),(0,n._)("div",ut,[(0,n.wy)((0,n._)("input",{class:"form-control",placeholder:"enter message","onUpdate:modelValue":t[0]||(t[0]=t=>e.msg=t),onKeyup:t[1]||(t[1]=(0,s.D2)((e=>c.send()),["enter"]))},null,544),[[s.nr,e.msg]]),(0,n._)("button",{class:"btn btn-default",onClick:t[2]||(t[2]=e=>c.send())},"send")])])])])):(0,n.kq)("",!0),0===this.matches.length?((0,n.wg)(),(0,n.iD)("h1",ht," Come back when you match with someone! ")):(0,n.kq)("",!0)],64)}var pt=r(8e3),mt=r.n(pt),dt=r(5016),gt=r.n(dt),ft={components:{Button:f},name:"Chat",data(){return{matches:[],received_messages:[],user:null,current_recipient:null}},async created(){let e=localStorage.getItem("jwt");e=e.substring(1,e.length-1),await this.getUser(e),await this.getMatches(e),this.connect(e)},methods:{setCurrentRecipient(e){this.current_recipient=e,null!=localStorage.getItem(this.getCurrentConvoId())?this.received_messages=JSON.parse(localStorage.getItem(this.getCurrentConvoId())):this.received_messages=[]},async getMatches(e){try{const t=await q().get("https://musicmatcher-api.herokuapp.com/spotifymatcher/users/matches",{headers:{jwt:e}});this.matches=t.data,this.matches.length>0&&(this.current_recipient=t.data[0],null!=localStorage.getItem(this.getCurrentConvoId())&&(this.received_messages=JSON.parse(localStorage.getItem(this.getCurrentConvoId()))))}catch(t){this.$router.push("error"),console.error(t)}},async getUser(e){try{const t=await q().get("https://musicmatcher-api.herokuapp.com/spotifymatcher/users/profile",{headers:{jwt:e}});this.user=t.data}catch(t){this.$router.push("error"),console.error(t)}},send(){if(this.msg.length>0){const e={senderId:this.user.id,recipientId:this.current_recipient.id,content:this.msg};this.stompClient.send("/app/private",JSON.stringify(e),{}),this.persistMessage(e),this.received_messages.push(e),this.msg="",this.scrollToEnd()}},scrollToEnd(){var e=this.$el.querySelector("#messages");e.scrollTop=e.scrollHeight},persistMessage(e){const t=this.calConvoId(e);if(null==localStorage.getItem(t)){const r=[e];localStorage.setItem(t,JSON.stringify(r))}else{let r=JSON.parse(localStorage.getItem(t));r.push(e),localStorage.setItem(t,JSON.stringify(r))}},connect(e){this.socket=new(mt())("https://music-matcher-chatapp.herokuapp.com/chat"),this.stompClient=gt().over(this.socket),this.stompClient.connect({},(t=>{this.stompClient.subscribe(`/user/${this.user.id}/dm`,(e=>{console.log("messag received"+e.body);const t=JSON.parse(e.body);this.persistMessage(t),this.received_messages.push(t),this.getCurrentConvoId()===this.calConvoId(t)&&this.scrollToEnd()}),{id:this.user.id,jwt:e})}),(e=>{this.$router.push({name:"Error",params:{message:"Chat server is down"}}),console.log(e)}))},getCurrentConvoId(){return this.hashCode(this.user.id)+this.hashCode(this.current_recipient.id)},calConvoId(e){return this.hashCode(e.senderId)+this.hashCode(e.recipientId)},hashCode(e){for(var t=0,r=0;r<e.length;r++){var s=e.charCodeAt(r);t=(t<<5)-t+s,t&=t}return t}}};const wt=(0,d.Z)(ft,[["render",lt],["__scopeId","data-v-9a0e2420"]]);var vt=wt;const kt=r(9669),yt=((0,E.yj)(),["/","/login","/callback","/error","/about"]),bt=[{path:"/chat",name:"Chat",component:vt},{path:"/error",name:"Error",component:Fe,props:!0},{path:"/about",name:"About",component:ze},{path:"/matcher",name:"Matcher",component:Be},{path:"/matches",name:"Matches",component:Ue},{path:"/tracks",name:"TracksView",component:be},{path:"/home",name:"Home",component:se},{path:"/profile",name:"ProfileView",component:G},{path:"/refresh",beforeEnter(e,t,r){Util.refreshToken()}},{path:"/login",beforeEnter(e,t,r){async function s(){return await kt.get("https://musicmatcher-api.herokuapp.com/spotifymatcher/authentication/url",{headers:{baseRoute:"https://dev-rifaii.github.io/music-matcher-frontend"}}).catch((function(e){Dt.push({name:"Error",params:{message:"Server is down"}})}))}async function n(){const e=await s();null!=e&&window.location.replace(e.data)}n()}},{path:"/callback",async beforeEnter(e,t){let r=new URLSearchParams(window.location.search),s=r.get("code");await St(s);let n=await _t();await It(n),jt()?Dt.push("/home"):setTimeout((function(){Dt.push("/home")}),2e3)}}];async function _t(){const e=JSON.parse(localStorage.getItem("token"));try{const t=await kt.get("https://musicmatcher-api.herokuapp.com/spotifymatcher/authentication/id",{headers:{token:e.access_token}});return t.data}catch(t){Dt.push("error"),console.error(t)}}async function St(e){async function t(){return await kt.get("https://musicmatcher-api.herokuapp.com/spotifymatcher/authentication/token",{headers:{code:e,baseRoute:"https://dev-rifaii.github.io/music-matcher-frontend"}}).catch((function(e){return e.response}))}async function r(){const e=await t();if(400===e.status)Dt.push({name:"Error",params:{message:"There was a problem logging in."}});else{new Date;Ct(e.data.access_token),localStorage.setItem("token",JSON.stringify(e.data))}}await r()}async function It(e){async function t(){return await kt.get("https://music-matcher-jwt.herokuapp.com/api/token",{headers:{userId:e}}).catch((function(e){return e.response}))}async function r(){const e=await t();400===e.status?Dt.push({name:"Error",params:{message:"There was a problem logging in."}}):localStorage.setItem("jwt",JSON.stringify(e.data))}await r()}function Ct(e){kt.post("https://musicmatcher-api.herokuapp.com/spotifymatcher/authentication/persist",null,{headers:{token:e}})}const Dt=(0,E.p7)({history:(0,E.PO)("/music-matcher-frontend/"),routes:bt});function jt(){return null!=localStorage.getItem("token")}function Ot(){const e=Date.now();return JSON.parse(localStorage.getItem("token")).expires_at>e}Dt.beforeEach(((e,t)=>!!(jt()&&Ot()||yt.includes(e.path))));var xt=Dt;(0,s.ri)(U).use(xt).mount("#app")}},t={};function r(s){var n=t[s];if(void 0!==n)return n.exports;var o=t[s]={exports:{}};return e[s].call(o.exports,o,o.exports,r),o.exports}r.m=e,function(){var e=[];r.O=function(t,s,n,o){if(!s){var a=1/0;for(h=0;h<e.length;h++){s=e[h][0],n=e[h][1],o=e[h][2];for(var c=!0,i=0;i<s.length;i++)(!1&o||a>=o)&&Object.keys(r.O).every((function(e){return r.O[e](s[i])}))?s.splice(i--,1):(c=!1,o<a&&(a=o));if(c){e.splice(h--,1);var u=n();void 0!==u&&(t=u)}}return t}o=o||0;for(var h=e.length;h>0&&e[h-1][2]>o;h--)e[h]=e[h-1];e[h]=[s,n,o]}}(),function(){r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,{a:t}),t}}(),function(){r.d=function(e,t){for(var s in t)r.o(t,s)&&!r.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){r.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={143:0};r.O.j=function(t){return 0===e[t]};var t=function(t,s){var n,o,a=s[0],c=s[1],i=s[2],u=0;if(a.some((function(t){return 0!==e[t]}))){for(n in c)r.o(c,n)&&(r.m[n]=c[n]);if(i)var h=i(r)}for(t&&t(s);u<a.length;u++)o=a[u],r.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return r.O(h)},s=self["webpackChunkst"]=self["webpackChunkst"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=r.O(void 0,[998],(function(){return r(6125)}));s=r.O(s)})();
//# sourceMappingURL=app.b3aa792a.js.map